<!--
Exopticon - A free video surveillance system.
Copyright (C) 2021 David Matthew Mattli <dmm@mattli.us>

This file is part of Exopticon.

Exopticon is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Exopticon is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with Exopticon.  If not, see <http://www.gnu.org/licenses/>.
-->

<div class="top-bar">
  <div class="title">
    <h2>Events</h2>
    <div class="date">
      {{ now.toLocalDate().toString() }}
      {{ now.toLocalDate().dayOfWeek().name() }}
    </div>
  </div>
  <div class="navigation">
    <button type="button" class="refresh" (click)="refreshEvents()">
      REFRESH
    </button>
    <button type="button" class="minus" (click)="addDuration(1)">
      PREV DAY
    </button>
    <button type="button" class="today" (click)="resetDuration()">TODAY</button>
    <button type="button" class="plus" (click)="addDuration(-1)">
      NEXT DAY
    </button>
  </div>
</div>
@if (state === eventListState.Loading) {
  <div class="events_wrapper">
    Loading...
  </div>
}
<div class="events-wrapper">
  @for (event of events$ | async; track event; let index = $index) {
    <div class="event">
      <div class="info">
        {{ formatInstant(event.beginTime) }}
        {{ event.tag }}
        {{ (event.interval.toDuration().toMillis() / 1000).toFixed(1) }}s
      </div>
      <div class="ratio">
        @if (selectedEvent != index) {
          <img
            src="/v1/events/{{ event.id }}/snapshot"
            />
        }
        @if (selectedEvent != index) {
          <div
            class="playbutton"
            (click)="onEventClick(index)"
            >
            &#9654;
          </div>
        }
        @if (selectedEvent == index && event.observations.length > 0) {
          <video
            controls
            autoplay
            loop
            >
            <source src="/v1/events/{{ event.id }}/clip" type="video/mp4" />
          </video>
        }
      </div>
    </div>
  }
</div>
